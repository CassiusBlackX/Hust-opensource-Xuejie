# 结构和硬件支持

## 操作系统虚拟机

### 在裸机上配置了操作系统程序就构成了操作系统虚拟机,操作系统在裸机上运行,用户在扩充后的操作系统虚拟机上运行

### 裸机的指令系统

- 机器指令

### 操作系统虚拟机的指令系统

- 操作命令
- 系统功能调用

## 操作系统的组织结构

### 简单结构

- 没有拆分成模块

### 层次结构

- 将操作系统分为多层（level）

### 微内核结构

- 所有的用户程序和操作系统管理模块都和一个内核相互联系

### 外核结构

- 让内核分配机器的物理资源给多个应用程序，并让每个程序决定如何处理这些资源

### VMM虚拟机

- 虚拟机管理器将单独的机器接口转换成很多的虚拟机，每个虚拟机都是一个原始计算机系统的有效副本, 并能完成所有的处理器指令

## 处理机的特权级

### 处理机的态

- 代表中央处理机的工作状态,代表当前处理机正在执行哪些程序,决定处理机的态.
- 分类

	- 管态

		- 操作系统管理程序执行的时候
		- 可以使用全部指令、使用全部系统资源

	- 用户态

		- 用户程序执行的时候
		- 禁止使用特权指令

### 特权指令集

- 外部设备输入输出
- 修改特殊寄存器
- 改变机器状态

### 如何区分处理机的态呢?

- 利用处理器状态标志将处理器设置成不同状态
- 引入程序状态字PSW

## 中断技术

### 定义

- 某个事件发生的时候,系统中止现有程序进行、引出事件处理程序对事件进行处理,处理完毕后返回断点继续执行.

### 分类(了解即可)

- 功能

	- 输入输出

		- I/O

	- 外中断

		- 时钟,控制台等来自处理机外部的

	- 机器故障中断

		- 电源故障等

	- 程序性中断

		- 非法操作等

	- 访管中断

- 中断方式

	- 不是正在运行的程序期待的中断(被动打断)
	- 是运行的程序期待的事件(主动打断)

- 相关概念

	- 中断源：引起中断的事件称中断源，如打印完成中断，其中断源是打印机。
	- 断点：发生中断时正在运行的程序被暂时停止，程序的暂停点称为断点。
	- 中断响应：是处理机发现有中断请求时，中止现运行程序的执行并自动引出中断处理程序的过程。
	- 中断是硬件和软件协同的处理的,由硬件来发现中断进入中断,进入中断后,然后让软件来执行对中断事件的处理.

### 中断响应

- 保护现场

	- 中断发生的时候,把现场信息保存在主存中.

- 恢复现场

	- 把现场信息从主存送入到相应的寄存器

- 所以说,什么是中断响应呢?

	- 中断响应是CPU发现有中断请求,中止现行程序进行,引出中断处理程序的过程.(进入中断程序执行)

- 过程

	- 保留断点信息和现场
	- 写入PC和PS,自动进入相应的中断处理程序

### 软件中断处理

- 硬件完成了中断进入过程后,由相应的中断处理程序获得了控制权,进入了软件中断处理的过程.

### 中断返回

- 执行恢复现场,把现场信息从主存送入到相应的寄存器

### 中断处理的顺序

- 中断响应,保留断点,进入中断处理程序
- 中断处理程序处理中断
- 中断返回,把主存中的现场信息恢复到各个寄存器里面

### 多重中断

- 中断优先级

	- 给中断设置一个优先级

- 中断屏蔽

	- 可以屏蔽中断,就是屏蔽掉某些中断请求达到不进入中断的目的.

- 多个中断的处理

	- 处理中断的时候禁止被其他中断打断
	- 允许高优先级的中断打断低优先级的中断

## 必要的硬件支持

### 存储器

### 时钟

*XMind - Trial Version*